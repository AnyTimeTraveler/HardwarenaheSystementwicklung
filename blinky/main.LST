A51 MACRO ASSEMBLER  MAIN                                                                 11/30/2022 16:09:47 PAGE     1


MACRO ASSEMBLER A51 V7.10
OBJECT MODULE PLACED IN main.OBJ
ASSEMBLER INVOKED BY: D:\Programme\Keil\C51\BIN\A51.EXE main.a51 SET(SMALL) DEBUG EP

LOC  OBJ            LINE     SOURCE

                       1     ;$INCLUDE(REG51.INC)
                       2     
                       3     NAME startup
                       4     
                       5     
  0000                 6     counter DATA 0x0000
                       7     
  2000                 8     MAX_RAM_ADDR EQU 8192
                       9     
                      10     
  0000                11     external_ram XDATA 0x0000
                      12     
                      13     
                      14     ; Programmstart hier
----                  15     CSEG AT 0x0000
                      16     ; Aus dem Interrupt-Vektor raus springen
                      17     ; Der Vektor sollte bis 0x33 gehen
                      18     ; Sicherere ist es, ein Wenig hoeher zu springen.
0000 2100             19     JMP 0x0100
                      20     
                      21     ; Eigentlicher Programmcode
----                  22     CSEG AT 0x0100
                      23     
                      24     ; move stack to the indirect addressed area, so the other register banks are free
                      25     ; normally, the stack starts at 0x07, which is the start of the second register bank
0100 7581FF           26     MOV SP, #0xFF
                      27     
                      28     ; Timer 1 $ Timer 0
                      29     ; MODE BITS
                      30     ; GATE | Counter/Timer | Mode 1 | Mode 0
                      31     ; 
                      32     ; Mode 00: 13 Bit Timer, 5 Bit Prescaler
                      33     ; Mode 01: 16 Bit Timer, 0 Bit Prescaler
                      34     ; Mode 11: 2x 8 Bit Timer (separat)
                      35     ; 
0103 758911           36     mov TMOD, #0001$0001b
                      37     
                      38     ; Interrupts allgemein aktivieren
0106 D2AF             39     SETB EA
                      40     
                      41     ; Timer 0 Interrupt aktivieren
0108 D2A9             42     SETB ET0
                      43     
                      44     ; Timer 0 Run aktivieren
010A D28C             45     SETB TR0
                      46     
010C 900000           47     mov DPTR, #0x0000
                      48     
010F                  49     loop: 
010F E582             50     mov A, DPL
0111 F500             51     mov counter, A
                      52     
0113 F0               53     MOVX @DPTR, A
0114 E0               54     MOVX A, @DPTR
0115 B50008           55     CJNE A, counter, error
0118 A3               56     INC DPTR
                      57     
0119 E583             58     mov A, DPH
A51 MACRO ASSEMBLER  MAIN                                                                 11/30/2022 16:09:47 PAGE     2

011B B420F1           59     CJNE A, #32, loop
                      60     
                      61     ; done!
011E 80FE             62     jmp $
                      63     
0120                  64     error:
                      65     
                      66     ; infinite loop
0120 80FE             67     JMP $
                      68     
                      69     
                      70     ; Code Segment an Stelle des Timer 0 Interrupts
----                  71     CSEG AT 0x000B
                      72     ; Wechsel auf die 2. Registerbank
000B D2D3             73     SETB RS0
                      74     ; Keine Instruktion. Der Assembler muss auch wissen,
                      75     ; dass ab hier die 2. Registerbank verwendet wird.
                      76     USING 2
                      77     
                      78     ; R0 ist unser Zaehler
                      79     ; Wir erhalten 25,43 Interrupts pro Sekunde
                      80     ; Da wir die LED nur alle halbe Sekunde blinken lassen,
                      81     ; muessen wir also Interrupts zaehlen
000D 08               82     INC R0
                      83     
                      84     
                      85     ; Wenn R0 auf 0 um
000E B80D09           86     CJNE R0, #13, skip
0011 30B504           87     jnb P3.5, setled
0014 C2B5             88     clr P3.5
0016 8002             89     jmp skip
0018                  90     setled:
0018 D2B5             91     setb P3.5
001A                  92     skip:
                      93     
                      94     ; Wechsel zurueck auf die 1. Registerbank
001A C2D3             95     CLR RS0
                      96     USING 1
001C 32               97     RETI
                      98     
                      99     
                     100     END
                             
A51 MACRO ASSEMBLER  MAIN                                                                 11/30/2022 16:09:47 PAGE     3

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

COUNTER. . . . . .  D ADDR   0000H   A   
DPH. . . . . . . .  D ADDR   0083H   A   
DPL. . . . . . . .  D ADDR   0082H   A   
EA . . . . . . . .  B ADDR   00A8H.7 A   
ERROR. . . . . . .  C ADDR   0120H   A   
ET0. . . . . . . .  B ADDR   00A8H.1 A   
EXTERNAL_RAM . . .  X ADDR   0000H   A   
LOOP . . . . . . .  C ADDR   010FH   A   
MAX_RAM_ADDR . . .  N NUMB   2000H   A   
P3 . . . . . . . .  D ADDR   00B0H   A   
RS0. . . . . . . .  B ADDR   00D0H.3 A   
SETLED . . . . . .  C ADDR   0018H   A   
SKIP . . . . . . .  C ADDR   001AH   A   
SP . . . . . . . .  D ADDR   0081H   A   
STARTUP. . . . . .  N NUMB   -----       
TMOD . . . . . . .  D ADDR   0089H   A   
TR0. . . . . . . .  B ADDR   0088H.4 A   


REGISTER BANK(S) USED: 0 1 2 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
